<!-- vr.html -->
<!DOCTYPE html>
<html>
<head>
    <title>VR Test Connection</title>
    <style>
        body { font-family: sans-serif; padding: 20px; font-size: 2em; }
        .status { padding: 10px; border: 1px solid #ccc; margin-top: 10px; }
        .error { background-color: #ffdddd; border-left: 5px solid red; }
        .success { background-color: #ddffdd; border-left: 5px solid green; }
    </style>
</head>
<body>
    <h1>VR Device Socket.IO Test</h1>
    <div id="statusDiv" class="status">Attempting to connect...</div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const statusDiv = document.getElementById('statusDiv');

        function updateStatus(message, isError = false) {
            console.log("VR_TEST: " + message);
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + (isError ? 'error' : 'success');
        }

        try {
            // Ensure the URL for io() is correct if your server is on a different domain/port for socket.io
            // If server.js and vr.html are served from the same origin, io() is fine.
            // Otherwise, use io('http://<SERVER_IP>:3000');
            const socket = io(); // Or explicitly: const socket = io('http://YOUR_SERVER_IP:3000');

            socket.on('connect', () => {
                updateStatus('SUCCESS: Connected to Socket.IO server! Registering as VR...');
                socket.emit('register-device', 'vr');
                // You should see "Device registered: vr" on your server console now
            });

            socket.on('disconnect', (reason) => {
                updateStatus(`DISCONNECTED: ${reason}`, true);
            });

            socket.on('connect_error', (err) => {
                updateStatus(`CONNECTION ERROR: ${err.message}. Type: ${err.type}. Description: ${err.description}`, true);
                console.error('VR_TEST: Connection Error details:', err);
            });

        } catch (e) {
            updateStatus(`CRITICAL JAVASCRIPT ERROR: ${e.message}`, true);
            console.error("VR_TEST: Critical JS error: ", e);
        }
    </script>
</body>
</html>
